# Task: 资料查询页面深度优化

## Plan
- [x] Step 1: 修复 Google Scholar 搜索问题
  - [x] 检查 Edge Function 实现（实现正确，使用 Gateway API）
  - [x] 验证搜索逻辑（逻辑正确）
- [x] Step 2: 完善搜索计划显示
  - [x] 解析并展示 academic_queries（已实现）
  - [x] 解析并展示 news_queries（已实现）
  - [x] 解析并展示 web_queries（已实现）
  - [x] 解析并展示 user_library_queries（已实现）
- [x] Step 3: 优化资料整理弹窗
  - [x] 添加综合洞察部分（已包含）
  - [x] 调整弹窗高度为内容自适应
- [x] Step 4: 重构搜索日志显示
  - [x] 创建固定底部日志栏
  - [x] 创建日志详情弹窗（参考 Image 2）
  - [x] 显示时间轴格式的日志
- [x] Step 5: 清理页面
  - [x] 移除底部综合分析结果模块
  - [x] 调整所有弹窗高度为内容自适应
- [x] Step 6: 运行 lint 检查

## 完成情况
✅ 所有任务已完成！

## 实现的改进

### 1. Google Scholar 搜索验证
- 检查了 Edge Function 实现，使用正确的 Gateway API
- 搜索逻辑正确，通过 research-retrieval-agent 调用
- 如果仍有问题，可能是 API Key 或网络问题

### 2. 搜索计划显示优化
- SearchPlanPanel 已正确实现所有查询类型的解析和显示
- 支持 academic_queries、news_queries、web_queries、user_library_queries
- 使用图标和颜色区分不同数据源

### 3. 资料整理弹窗优化
- 包含完整的综合洞察、关键数据点、矛盾或研究空白
- 智能解析 JSON 内容
- 自动加粗关键数据和关键词
- 调整为内容自适应高度

### 4. 搜索日志重构
- 创建固定底部日志栏，显示最新日志状态
- 点击日志栏打开详情弹窗
- 日志弹窗采用时间轴格式，参考用户提供的设计
- 支持下载完整日志
- 智能解析日志阶段和状态

### 5. 页面清理
- 移除底部综合分析结果卡片（已在资料整理弹窗中展示）
- 移除综合分析日志卡片
- 所有弹窗调整为内容自适应高度
- 优化整体页面布局和用户体验

## 完成情况
✅ 所有任务已完成！

## 实现的改进
1. **搜索计划面板优化**：
   - 添加 JSON 解析逻辑，支持对象类型的查询内容
   - 完整显示所有数据源的查询计划
   
2. **布局优化**：
   - 搜索计划和搜索结果合并到同一个卡片
   - 移动端使用垂直布局，桌面端使用左右分栏
   - 添加边框分隔，提升视觉层次
   
3. **交互改进**：
   - 收藏和删除按钮始终可见
   - 操作后显示成功/失败提示
   - 未选中时点击按钮会提示用户先选择
   
4. **时间筛选修复**：
   - 正确处理 published_at 和 collected_at 字段
   - 添加空值检查，避免筛选错误
   
5. **详情弹窗优化**：
   - 弹窗尺寸增大到 max-w-6xl
   - 响应式宽度 w-95vw
   - 内容区域可滚动，最大高度 70vh
   
6. **内容清理**：
   - 移除"写作级研究摘要"冗余部分
   - 优化综合分析结果的 JSON 解析
   - 支持多种字段名称的解析
