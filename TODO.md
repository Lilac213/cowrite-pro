# 任务：邀请码和积分系统

## 完成情况

### ✅ 已完成

#### 1. 数据库架构
- [x] 创建 invitation_codes 表
  - 8位邀请码
  - AI降重次数限制
  - 项目数量限制
  - 使用次数统计
  - 激活状态
- [x] 扩展 profiles 表
  - 积分余额 (credits)
  - AI降重已使用/限制 (ai_reducer_used/limit)
  - 项目已创建/限制 (projects_created/limit)
  - 邀请码关联 (invitation_code)
- [x] RLS 安全策略
  - 管理员可管理所有邀请码
  - 用户可查看自己的邀请码

#### 2. 类型定义
- [x] 更新 Profile 接口，添加积分和限制字段
- [x] 新增 InvitationCode 接口

#### 3. API 函数 (src/db/api.ts)
- [x] createInvitationCode - 生成随机8位邀请码
- [x] getAllInvitationCodes - 获取所有邀请码（管理员）
- [x] useInvitationCode - 验证并使用邀请码
- [x] deactivateInvitationCode - 停用邀请码
- [x] checkAIReducerLimit - 检查AI降重次数
- [x] incrementAIReducerUsage - 增加AI降重使用次数
- [x] checkProjectLimit - 检查项目创建限制
- [x] incrementProjectCount - 增加项目创建次数
- [x] purchaseCredits - 购买积分（预留接口）

#### 4. 管理员页面 (AdminPage.tsx)
- [x] 新增"邀请码管理"标签页
- [x] 邀请码生成对话框
  - 设置AI降重次数
  - 设置项目数量
- [x] 邀请码列表展示
  - 邀请码、限制、使用次数、状态
  - 复制邀请码功能
  - 停用邀请码功能
- [x] 用户列表增强
  - 显示积分余额
  - 显示AI降重使用情况
  - 显示项目数量情况

#### 5. 设置页面 (SettingsPage.tsx)
- [x] 用户信息卡片增强
  - 显示积分余额
  - 显示AI降重使用情况 (已使用/限制)
  - 显示项目数量情况 (已创建/限制)
- [x] 购买点数功能
  - 体验包：16点 ¥9.9 (AI降重+5次, 项目+3个)
  - 推荐包⭐：66点 ¥29.9 (AI降重+20次, 项目+10个)
  - 进阶包：166点 ¥79.9 (AI降重+50次, 项目+25个)
  - 专业包：366点 ¥149.9 (AI降重+100次, 项目+50个)
  - 精美的套餐卡片展示
  - 推荐标签突出显示

#### 6. AI降重页面 (AIReducerPage.tsx)
- [x] 使用次数显示
- [x] 次数不足提示
- [x] 购买点数引导按钮
- [x] 使用前检查限制
- [x] 使用后自动扣减次数

#### 7. 项目列表页面 (ProjectListPage.tsx)
- [x] 项目配额显示
- [x] 配额不足提示
- [x] 购买点数引导按钮
- [x] 创建前检查限制
- [x] 创建后自动增加计数
- [x] 禁用新建按钮（配额不足时）

## 功能说明

### 邀请码系统
1. 管理员可以生成8位随机邀请码
2. 生成时设置：
   - AI降重工具可用次数
   - 可创建项目数量
3. 邀请码可以被多次使用（记录使用次数）
4. 管理员可以停用邀请码
5. 用户使用邀请码后获得对应权限

### 积分和限制系统
1. 用户有三个核心指标：
   - 积分余额（用于购买）
   - AI降重次数（已使用/限制）
   - 项目数量（已创建/限制）
2. 超过限制时：
   - 显示红色警告提示
   - 禁用相关功能
   - 引导用户购买点数
3. 购买点数后：
   - 增加积分余额
   - 增加对应的使用限制

### 购买点数
- 4个套餐选项，价格从¥9.9到¥149.9
- 推荐包有特殊标记（⭐最多人选择）
- 点击购买显示"功能开发中"提示（预留支付接口）

## 注意事项

1. **安全性**：所有限制检查都在服务端进行，前端只做展示
2. **用户体验**：超限时有明确的提示和引导
3. **扩展性**：预留了购买接口，方便后续接入支付系统
4. **数据完整性**：使用数据库约束和RLS策略保证数据安全
