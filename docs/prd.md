# CoWrite 写作辅助工具需求文档

## 1. 应用概述

### 1.1 应用名称

CoWrite

### 1.2 应用描述

CoWrite 是一款写作辅助工具，旨在帮助用户通过结构化流程完成高质量文章创作，核心目标是减少返工、确保信息可追溯、降低 AI 检测率，并将写作过程沉淀为可复用资产。

### 1.3 核心原则

- 选题与结构必须前置
- 个人素材优先于 AI 生成
- 三遍审校不可跳过
- 所有关键节点必须用户确认
- 所有中间产物都是长期资产

## 2. 用户旅程与阶段流程

### 2.1 整体流程图

创建项目 → 明确需求 → 资料查询 → 段落摘要 → 个人素材 → 文章生成 → 内容审校 → 终版输出

### 2.2 详细阶段说明

#### 阶段 0：注册/登录

- 用户完成注册或登录
- 登录成功后进入项目列表页
- 系统管理用户登录态

#### 阶段 1：项目列表与新建项目

- 展示用户的项目列表
- 支持新建项目
- 提供工具箱入口，包括：
  - 降 AI 率工具
  - 个人素材库
  - 参考文章库
  - 格式模板
- 项目状态包括：草稿、写作中、审校中、已完成
- 进度条保存历史内容，支持点击进度条中的节点，跳回到任意节点进行修改

#### 阶段 2：明确需求

- 用户输入文章选题/写作目标
- 选择格式模板/要求
- 指定输出格式（如公众号、报告等）
- AI 将输入结构化为需求文档
- 需求文档保存至 _briefs/ 文件夹，文件名格式：项目名-brief.md
- 用户必须确认需求后才能进入下一步
- **重新点击生成需求文档后，确认按钮需重置为待确认状态**

#### 阶段 3：AI 混合信息搜索与知识库沉淀

**P1：搜索意图拆解（学术 vs 现实）**

- 用户输入中文研究需求
- AI 分析需求，判断其中涉及的研究意图
- 拆解为学术搜索意图与实时网页搜索意图
- 学术意图：偏向理论、方法、研究共识
- 网页意图：偏向行业动态、产品、政策、实践
- 两类都可能为空或同时存在

**P2：学术搜索转写（给 OpenAlex）**

- 将学术搜索意图转写为英文学术数据库检索关键词
- 使用学术界常见术语，覆盖研究对象 + 方法
- 关键词数量 3-6 个
- 输出格式包含主要关键词和相关关键词

**P3：实时网页搜索转写（给 Tavily）**

- 将网页搜索意图转写为适合实时网页搜索引擎使用的英文查询语句
- 偏向自然语言，而非学术术语
- 可包含行业、产品、应用、趋势等词
- 不超过 2 条搜索 query

**P4：OpenAlex + Tavily 搜索**

- 使用英文学术关键词在 OpenAlex 进行学术论文搜索
- 使用英文查询语句在 Tavily 进行实时网页搜索
- OpenAlex 提供学术共识/理论基础
- Tavily 提供现实进展/产业/最新动态

**P5：跨源搜索结果筛选与对齐**

- 识别学术论文结果与实时网页搜索结果中主题一致的部分
- 标记哪些网页内容是对学术研究的现实补充
- 剔除明显无关或噪声内容
- 不合并写作，仅做筛选与分类
- 输出结构包含：学术核心内容、网页补充内容、丢弃内容

**P6：结构化学术 + 专业写作摘要**

- 基于已筛选的高质量来源，用中立、专业、可引用的语言总结核心观点
- 明确区分学术共识与行业实践/现实应用
- 避免编造结论，不确定的地方需标注
- 输出结构包含：
  - 背景总结
  - 学术洞察（观点 + 证据来源）
  - 行业洞察（观点 + 证据来源）
  - 开放性问题或争议
  - 建议的写作角度
- **此步骤完成后，用户可点击进入下一步（段落摘要）**

**知识库沉淀**

- 搜索结果以卡片形式展示，包含来源、发布时间、摘要
- 用户可勾选认可的信息
- 信息保存至 _knowledge_base/ 文件夹，文件名格式：主题-时间.md
- 必须包含：信息收集时间、信息来源、下次更新建议

#### 阶段 4：段落级摘要共建（结构锁定）

- AI 按顺序输出 7-8 个段落摘要（一句话）
- 用户可以：
  - 编辑摘要内容
  - 勾选或取消某段
  - 在中间或结尾位置让 AI 增加段落
- 用户必须确认段落结构后才能进入全文生成

#### 阶段 5：参考文章/个人素材（可选）

- 用户选择是否添加参考文章或个人素材
- 参考文章支持：
  - 写入链接，从 URL 中提取原文
  - 上传文件
  - 直接复制到文本框
- 参考文章支持关联到项目
- 参考文章保存至 _reference/ 文件夹，文件名格式：（提取名称）-时间.md
- 个人素材提供三个输入框：
  - 个人经历
  - 观点
  - 案例/实验
- 个人素材保存至 _human_character/ 文件夹，文件名格式：（提取名称）-时间.md
- 所有素材长期保存
- 系统自动打关键词，后续项目可复用

#### 阶段 6：协作文档生成全文

- AI 根据需求、知识库、段落摘要、个人素材生成完整文章
- 采用协作文档形式，用户可直接修改
- AI 修改有标记，不覆盖用户内容

#### 阶段 7：内容审校（三遍审校合并为一个节点）

**页面布局**

- 左侧：展示上一步生成的文章内容
- 右侧：三步审校流程，需按步骤依次进行
- 点击每一步审校后，左侧文本框直接更新为该步骤的审校结果，并标注修改位置
- 每一步审校过程中实时展示完成百分比，让用户对完成时间有所预期

**第一遍：内容审校**

- 检查事实准确性（数据、时间、产品名称）
- 检查逻辑清晰性（前后无矛盾）
- 检查结构合理性（无跑题）
- 检查是否有编造（所有数据和案例都真实）
- 可标注问题段落，必要时中断流程
- 审校过程中保持原文语种不变

**第二遍：风格审校（AI 味降重）**

- 删除套话：在当今时代、综上所述、值得注意的是
- 拆解 AI 句式：不是...而是...连续出现
- 替换书面词汇：显著提升 → 具体数字，充分利用 → 用好
- 改成口语化：进行操作 → 直接用动词
- 加入真实细节：抽象表达 → 具体数字/案例
- 加入个人态度：中立客观 → 明确观点
- 审校过程中保持原文语种不变

**第三遍：细节打磨**

- 检查句子长度（15-25 字为主，不超过 30 字）
- 检查段落长度（手机屏幕 3-5 行）
- 检查标点自然（多用句号，少用逗号连接长句）
- 检查节奏变化（快慢结合）
- 找出超过 30 字的长句并拆短
- 审校过程中保持原文语种不变

#### 阶段 8：终稿完成与资产沉淀

- 用户选择输出模板
- 用户选择输出方式（Word/PDF/Markdown）
- 系统检查：是否缺摘要、标题层级是否完整
- AI/引擎执行：自动套用格式、自动生成目录
- 提供导出按钮，直接导出最终文章
- 沉淀完整写作过程资产
- 素材库支持关键词检索
- 后续项目可自动推荐相关素材

## 3. 核心功能

### 3.1 项目管理

- 项目列表展示
- 新建项目
- 项目状态管理
- 进度条保存历史内容，支持点击进度条中的节点，跳回到任意节点进行修改

### 3.2 需求输入与需求文档生成

- 结构化需求输入
- AI 自动生成需求文档
- 需求确认机制
- 重新生成需求文档后，确认按钮重置为待确认状态

### 3.3 混合信息搜索与知识库

**搜索意图拆解**

- 分析中文需求，判断研究意图
- 拆解为学术搜索意图与实时网页搜索意图

**学术搜索转写**

- 学术搜索意图转英文学术关键词
- 输出主要关键词和相关关键词

**实时网页搜索转写**

- 网页搜索意图转英文查询语句
- 偏向自然语言表达

**OpenAlex + Tavily 搜索**

- 使用英文关键词在 OpenAlex 搜索学术论文
- 使用英文查询语句在 Tavily 搜索实时内容

**跨源结果筛选与对齐**

- 识别主题一致的部分
- 标记网页内容对学术研究的现实补充
- 剔除无关或噪声内容

**结构化学术 + 专业写作摘要**

- 用中立、专业、可引用的语言总结核心观点
- 明确区分学术共识与行业实践/现实应用
- 避免编造结论，不确定的地方需标注
- 输出结构包含：背景总结、学术洞察、行业洞察、开放性问题或争议、建议的写作角度
- 完成后提供进入下一步的入口

**知识库管理**

- 分来源卡片展示
- 信息勾选与保存
- 知识库长期存储

### 3.4 段落摘要与结构确认

- AI 生成段落摘要
- 摘要编辑与排序
- 段落增删

### 3.5 素材管理

#### 3.5.1 个人素材库（Personal Notes / Ideas）

**基础数据结构**

- 素材 ID
- 内容（支持富文本/markdown）
- 来源（手动/AI生成/外部导入）
- 标签（多选，自定义）
- 创建时间/最近编辑时间
- 关联项目（0-n）
- 状态（未使用/已使用/已加入项目）

**列表页能力**

- 按标签筛选
- 按时间排序（创建/最近使用）
- 搜索（全文+标签）
- 显示已关联项目数

**与项目的关系**

- 关联方式：在素材卡片上关联到项目，弹窗选择项目
- 关联后效果：项目侧边栏出现📎 已关联素材，点击可直接插入协作文档

**插入协作文档的方式**

- 插入为新段落（随机位置/当前光标）
- 插入为备注区
- 插入为草稿区

**AI 整理助手**

- 入口：素材库右上角🧠 AI 整理
- AI 能力：
  - 自动打标签（主题/立场/情绪）
  - 合并相似素材
  - 推荐可组合成一篇文章的素材集合
  - 推荐关联项目
- AI 输出交互：卡片形式观点，每条都能加入某项目、插入当前文档、存为素材

#### 3.5.2 参考文章库（Reference Library）

**文章字段**

- 文章标题
- 原文/链接
- 来源（URL/上传/文本框）
- 标签
- AI解析结果：
  - 核心观点
  - 结构大纲
  - 可借鉴段落

**新建参考文章方式**

- 写入链接，从 URL 中提取原文
- 上传文件
- 直接复制到文本框
- 支持关联到项目

**AI 整理助手**

- 入口：参考文章库右上角🧠 AI 提炼，按钮文案：✨ AI 整理这篇文章
- AI 输出结果（结构化）：
  - 本文核心观点 × 3
  - 可迁移写作角度
  - 适合放入哪些项目（推荐）
- 每一条观点都支持：加入个人素材库、加入项目草稿

**AI 能力**

- 拆解文章结构
- 抽取可迁移观点
- 转化为可写作素材

### 3.6 格式模板管理

#### 3.6.1 新建模板方式（AI 辅助生成）

**Step 1：用户输入自然语言**

用户输入格式描述，例如：本科毕业论文，理工科，封面包含：学校、学院、姓名、学号，正文小四宋体，1.5 倍行距，一级标题三号黑体居中

**Step 2：AI 解析为结构化格式规则**

系统内部生成：
- 页面结构 schema
- 样式规则表
- 校验规则（缺失摘要就提示）

AI 的角色是：把人话转成排版规则

**Step 3：用户预览 & 微调**

- 模板预览（假文内容）
- 可调整字号/行距
- 保存为模板

#### 3.6.2 模板的使用方式

- 模板不影响写作过程，只在终稿输出生效
- 使用时机：终稿确认 → 输出
- 用户操作：选择输出模板
- 用户选择输出方式：Word/PDF/Markdown
- 系统检查：是否缺摘要、标题层级是否完整
- AI/引擎执行：自动套用格式、自动生成目录
- 提供导出按钮，直接导出文章

### 3.7 协作文档

- AI 生成全文
- 用户实时编辑
- 修改痕迹标记

### 3.8 三遍审校系统（合并为内容审校节点）

- 页面布局：左侧展示文章，右侧三步审校流程
- 按步骤依次审校，点击后左侧直接更新为审校结果并标注修改位置
- 每一步审校过程中实时展示完成百分比
- 内容审校、风格审校、细节打磨
- 审校过程中保持原文语种不变
- 审校状态管理

### 3.9 降 AI 率工具

- 页面布局：
  - 左侧：文本输入框
  - 右侧：降 AI 率后的文章输出框
- 功能：
  - 支持上传文件导入文字
  - 点击降 AI 率按钮后，根据网上内容信息以及个人素材库，在右侧文本框输出降 AI 率之后的文章
  - 支持按照已有模板输出文章（pdf、word 或 md 格式）

### 3.10 资产沉淀

- 写作过程记录
- 素材库积累
- 跨项目复用

### 3.11 管理面板

- 权限控制：仅管理员可访问
- LLM 配置：
  - 默认配置：通义千问
  - 不提供其他选项
- 搜索配置：
  - OpenAlex：用于学术论文搜索
  - Tavily：用于实时内容和观点搜索
  - 需配置 Tavily API

## 4. 混合搜索 Prompt 规范

### 4.1 P1：搜索意图拆解 Prompt

```
你是一名研究型搜索专家。

请分析以下【中文需求】，判断其中涉及的研究意图，
并拆解为【学术搜索意图】与【实时网页搜索意图】。

要求：
1. 学术意图：偏向理论、方法、研究共识
2. 网页意图：偏向行业动态、产品、政策、实践
3. 两类都可能为空或同时存在
4. 不要解释

中文需求：
{{user_query_zh}}

输出格式（JSON）：
{
  \\"academic_intent\": \"\\",
  \"web_intent\": \"\"
}
```

### 4.2 P2：学术搜索转写 Prompt

```
你是一名学术搜索专家。

请将以下【学术搜索意图】转写为
【用于英文学术数据库（如 OpenAlex）检索的关键词】。

要求：
1. 使用学术界常见术语
2. 覆盖研究对象 + 方法
3. 关键词 3–6 个
4. 英文输出
5. 不要解释

学术搜索意图：
{{academic_intent}}

输出格式（JSON）：
{
  \"main_keywords\": [],
  \"related_keywords\": []
}
```

### 4.3 P3：实时网页搜索转写 Prompt

```
你是一名实时信息检索专家。

请将以下【网页搜索意图】转写为
【适合实时网页搜索引擎（如 Tavily）使用的英文查询语句】。

要求：
1. 偏向自然语言，而非学术术语
2. 可包含行业、产品、应用、趋势等词
3. 不超过 2 条搜索 query
4. 英文输出
5. 不要解释

网页搜索意图：
{{web_intent}}

输出格式（JSON）：
{
  \\"queries\": []
}
```

### 4.4 P4：跨源搜索结果筛选与对齐 Prompt

```
你是一名研究整合助手。

请基于以下两类搜索结果：
1. 学术论文结果（OpenAlex）
2. 实时网页搜索结果（Tavily）

完成以下任务：
- 识别两类内容中【主题一致的部分】
- 标记哪些网页内容是对学术研究的现实补充
- 剔除明显无关或噪声内容

要求：
1. 不合并写作
2. 仅做筛选与分类
3. 输出结构化结果

学术论文结果：
{{academic_results}}

网页搜索结果：
{{web_results}}

输出格式（JSON）：
{
  \"academic_core\": [],
  \"web_supporting\": [],
  \"discarded\": []
}
```

### 4.5 P5：结构化学术 + 专业写作摘要 Prompt

```
你是 CoWrite 的研究摘要生成模块。

基于已筛选的高质量来源，请完成以下任务：

1️⃣ 用中立、专业、可引用的语言总结核心观点  
2️⃣ 明确区分：
   - 学术共识
   - 行业实践 / 现实应用
3️⃣ 避免编造结论，不确定的地方需标注

输出结构必须包含：

{
  \"background_summary\": \\"...\",
  \\"academic_insights\": [
    {
      \\"point\": \"...\",
      \"evidence_source\": \\"academic\"
    }
  ],
  \"industry_insights\": [
    {
      \"point\": \"...\",
      \\"evidence_source\": \"industry\"
    }
  ],
  \"open_questions_or_debates\": [
    \\"...\"
  ],
  \\"suggested_writing_angles\": [
    \\"...\"
  ]
}

学术核心内容：
{{academic_core}}

网页补充内容：
{{web_supporting}}
```

## 5. 数据存储规范

### 5.1 需求文件

- 存储路径：_briefs/
- 文件名格式：项目名-brief.md

### 5.2 知识库文件

- 存储路径：_knowledge_base/
- 文件名格式：主题-时间.md
- 必须包含：信息收集时间、信息来源、下次更新建议

### 5.3 参考文章

- 存储路径：_reference/
- 文件名格式：（提取名称）-时间.md
- 长期保存
- 支持关键词检索
- 跨项目复用

### 5.4 个人素材

- 存储路径：_human_character/
- 文件名格式：（提取名称）-时间.md
- 长期保存
- 支持关键词检索
- 跨项目复用

## 6. 强制规则

### 6.1 流程控制

- 无 project_id 不允许进入后续流程
- 需求未确认禁止信息搜索
- Outline 未确认禁止生成全文
- 任一审校未完成不允许完成项目

### 6.2 用户确认节点

- 需求确认
- 段落结构确认
- 三遍审校完成确认

### 6.3 信息源优先级

- OpenAlex 学术数据库
- Tavily 实时内容搜索
- 权威科技媒体（TechCrunch、The Verge）
- 社区论坛（Reddit、Hacker News）
- 官方文档

### 6.4 混合搜索约束规则

- 网页搜索结果仅作为现实补充信息，不得用于生成学术结论或研究共识
- OpenAlex 提供学术共识/理论基础
- Tavily 提供现实进展/产业/最新动态
- AI 的职责是对齐，而不是混写
- 学术内容与网页内容必须分开展示

## 7. 状态机

init → confirm_brief → knowledge_selected → structured_summary_completed → outline_confirmed → drafting → content_review → completed

## 8. 参考文件

1. 管理面板配置截图：image.png
2. 项目进度条示例：image-2.png