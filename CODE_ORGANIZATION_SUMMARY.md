# Edge Functions ä»£ç ç»„ç»‡ä¼˜åŒ–æ€»ç»“

## é—®é¢˜

ç”¨æˆ·å‘ç°æ¯ä¸ª Edge Function ç›®å½•ä¸­éƒ½åµŒå¥—äº†å®Œæ•´çš„ `llm` ç›®å½•ï¼ˆåŒ…å« 6 ä¸ª agentsï¼‰ï¼Œè¿™æ˜¯ä¸åˆç†çš„é‡å¤ã€‚

## æ ¹æœ¬åŸå› 

Supabase Edge Functions çš„éƒ¨ç½²ç³»ç»Ÿ**ä¸æ”¯æŒè‡ªåŠ¨æ‰“åŒ… `_shared` ç›®å½•**ã€‚å½“ Edge Function çš„ `index.ts` ä¸­ä½¿ç”¨ `import ... from '../_shared/llm/...'` æ—¶ï¼Œéƒ¨ç½²ä¼šå¤±è´¥ï¼Œæç¤ºæ‰¾ä¸åˆ°æ¨¡å—ã€‚

## è§£å†³æ–¹æ¡ˆ

### æ¶æ„è®¾è®¡

1. **Single Source of Truth**
   - `supabase/functions/_shared/llm/` æ˜¯å”¯ä¸€çš„æºä»£ç ä½ç½®
   - æ‰€æœ‰ä»£ç ä¿®æ”¹éƒ½åœ¨æ­¤ç›®å½•è¿›è¡Œ

2. **è‡ªåŠ¨åŒæ­¥æœºåˆ¶**
   - åˆ›å»º `sync-shared.sh` è„šæœ¬
   - éƒ¨ç½²å‰è‡ªåŠ¨å°† `_shared/llm` å¤åˆ¶åˆ°å„å‡½æ•°ç›®å½•
   - è‡ªåŠ¨è°ƒæ•´ import è·¯å¾„ï¼ˆ`../_shared/llm/` â†’ `./llm/`ï¼‰

3. **ç‰ˆæœ¬æ§åˆ¶**
   - `.gitignore` å¿½ç•¥å„å‡½æ•°ä¸­çš„ `llm` å‰¯æœ¬
   - åªæäº¤ `_shared/llm` æºä»£ç 

### æ–‡ä»¶ç»“æ„

```
supabase/functions/
â”œâ”€â”€ _shared/llm/              # âœ… å”¯ä¸€æºä»£ç ï¼ˆæäº¤åˆ° Gitï¼‰
â”‚   â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ runtime/
â”‚   â””â”€â”€ schemas/
â”‚
â”œâ”€â”€ sync-shared.sh            # ğŸ”„ è‡ªåŠ¨åŒæ­¥è„šæœ¬
â”œâ”€â”€ ARCHITECTURE.md           # ğŸ“– æ¶æ„æ–‡æ¡£
â”œâ”€â”€ .gitignore                # ğŸš« å¿½ç•¥è‡ªåŠ¨ç”Ÿæˆçš„å‰¯æœ¬
â”‚
â”œâ”€â”€ brief-agent/
â”‚   â”œâ”€â”€ index.ts
â”‚   â””â”€â”€ llm/                  # âš ï¸ è‡ªåŠ¨ç”Ÿæˆï¼Œä¸æäº¤
â”‚
â””â”€â”€ structure-agent/
    â”œâ”€â”€ index.ts
    â””â”€â”€ llm/                  # âš ï¸ è‡ªåŠ¨ç”Ÿæˆï¼Œä¸æäº¤
```

## å·¥ä½œæµç¨‹

### ä¿®æ”¹ä»£ç 

```bash
# 1. åœ¨ _shared/llm ä¸­ä¿®æ”¹ä»£ç 
vim supabase/functions/_shared/llm/agents/briefAgent.ts

# 2. è¿è¡ŒåŒæ­¥è„šæœ¬
bash supabase/functions/sync-shared.sh

# 3. éƒ¨ç½²ï¼ˆé€šè¿‡å·¥å…·è‡ªåŠ¨å®Œæˆï¼‰
```

### åŒæ­¥è„šæœ¬åšä»€ä¹ˆ

```bash
sync-shared.sh:
1. åˆ é™¤å„å‡½æ•°ä¸­çš„æ—§ llm å‰¯æœ¬
2. ä» _shared/llm å¤åˆ¶æœ€æ–°ä»£ç 
3. è°ƒæ•´ import è·¯å¾„ï¼ˆ../_shared/llm/ â†’ ./llm/ï¼‰
```

## ä¼˜åŠ¿

âœ… **æ¸…æ™°çš„ä»£ç ç»„ç»‡**
- å¼€å‘è€…æ˜ç¡®çŸ¥é“åœ¨å“ªé‡Œä¿®æ”¹ä»£ç 
- é¿å…åœ¨å¤šä¸ªåœ°æ–¹ç»´æŠ¤ç›¸åŒä»£ç 

âœ… **è‡ªåŠ¨åŒ–åŒæ­¥**
- ä¸€é”®åŒæ­¥æ‰€æœ‰å‡½æ•°
- å‡å°‘äººä¸ºé”™è¯¯

âœ… **ç‰ˆæœ¬æ§åˆ¶å‹å¥½**
- åªæäº¤æºä»£ç 
- é¿å… Git ä¸­çš„å¤§é‡é‡å¤æ–‡ä»¶

âœ… **éƒ¨ç½²å…¼å®¹**
- æ»¡è¶³ Supabase Edge Functions çš„éƒ¨ç½²è¦æ±‚
- æ‰€æœ‰å‡½æ•°éƒ½èƒ½æˆåŠŸéƒ¨ç½²

## å·²åˆ é™¤çš„æœªä½¿ç”¨å‡½æ•°

- âŒ `openalex-search`
- âŒ `thenews-search`
- âŒ `web-search`

## æ–‡æ¡£

- `supabase/functions/ARCHITECTURE.md` - å®Œæ•´æ¶æ„è¯´æ˜
- `supabase/functions/_shared/llm/README.md` - LLM æ¶æ„æ–‡æ¡£
- `supabase/functions/sync-shared.sh` - åŒæ­¥è„šæœ¬ï¼ˆå¸¦æ³¨é‡Šï¼‰

## éªŒè¯

âœ… æ‰€æœ‰ 7 ä¸ª Agent å‡½æ•°å·²æˆåŠŸéƒ¨ç½²
âœ… Lint æ£€æŸ¥é€šè¿‡ï¼ˆ0 errorsï¼‰
âœ… ä»£ç ç»„ç»‡æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
